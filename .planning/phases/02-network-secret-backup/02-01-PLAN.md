---
phase: 02-network-secret-backup
plan: 01
type: execute
wave: 1
depends_on: ["01-01", "01-02"]
files_modified:
  - scripts/uat-backup-network-secret.sh
  - scripts/uat-simple-secret-split.go
  - charts/ten-backup/templates/configmap.yaml
autonomous: true

must_haves:
  truths:
    - "Backup creation via ten_BackupSharedSecret API produces encrypted backup files"
    - "Encrypted backups split into 2-of-3 simple shares with guardian distribution"
    - "Secret splitting produces verifiable shares that reconstruct to original secret"
  artifacts:
    - path: "scripts/uat-backup-network-secret.sh"
      provides: "UAT network secret backup with simple share splitting"
      min_lines: 50
    - path: "scripts/uat-simple-secret-split.go"
      provides: "Simple 2-of-3 Shamir secret sharing implementation"
      contains: "func SplitSecret"
    - path: "charts/ten-backup/templates/configmap.yaml"
      provides: "Updated configmap with new backup scripts"
      contains: "uat-backup-network-secret.sh"
  key_links:
    - from: "scripts/uat-backup-network-secret.sh"
      to: "ten_BackupSharedSecret API"
      via: "JSON-RPC call"
      pattern: "ten_backupSharedSecret"
    - from: "scripts/uat-simple-secret-split.go"
      to: "scripts/decrypt-backup.go"
      via: "shared crypto functions"
      pattern: "github.com/ethereum/go-ethereum/crypto"
---

<objective>
Implement Ten network shared secret backup with simple UAT secret sharing

Purpose: Enable UAT testing of network consensus secret backup and recovery using simple 2-of-3 threshold cryptography
Output: Working backup system that creates encrypted backups and splits them into recoverable shares
</objective>

<execution_context>
@/Users/krish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/krish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-CONTEXT.md
@scripts/uat-backup-shared-secret.sh
@scripts/decrypt-backup.go
@.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Network Secret Backup Script</name>
  <files>scripts/uat-backup-network-secret.sh</files>
  <action>
    Create enhanced backup script based on existing uat-backup-shared-secret.sh that:

    - Calls ten_BackupSharedSecret API on any UAT validator (configurable FQDN)
    - Decrypts the response using existing decrypt-backup.go pattern
    - Validates decrypted secret is 64 hex chars (32 bytes)
    - Calls the simple secret splitting tool to create 2-of-3 shares
    - Outputs three share files: share-1.txt, share-2.txt, share-3.txt
    - Prints guardian instructions for secure storage of shares

    Use the working uat-backup-shared-secret.sh as the base. Remove Azure KeyVault storage (UAT only). Add secret splitting after decryption step. Include verification that shares can reconstruct the original secret.
  </action>
  <verify>
    bash -n scripts/uat-backup-network-secret.sh # syntax check
  </verify>
  <done>
    Script validates syntactically and includes all phases: API call, decryption, secret splitting, validation, and guardian output
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Simple Secret Sharing Tool</name>
  <files>scripts/uat-simple-secret-split.go</files>
  <action>
    Create a Go program implementing simple Shamir secret sharing for UAT testing:

    - Implements 2-of-3 threshold secret sharing using basic polynomial interpolation
    - SplitSecret(secret string) returns 3 shares as hex strings
    - CombineShares(share1, share2 string) returns reconstructed secret
    - Uses existing crypto imports from decrypt-backup.go (github.com/ethereum/go-ethereum/crypto)
    - Includes validation that any 2 shares reconstruct the original secret
    - CLI interface: -split <hex_secret> OR -combine <share1> <share2>

    This is for UAT only - simple implementation over a finite field, not production SLIP-39. Focus on correctness and testability over security features.
  </action>
  <verify>
    cd scripts && go run uat-simple-secret-split.go -split 0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
  </verify>
  <done>
    Tool splits a 32-byte test secret into 3 shares and can reconstruct from any 2 shares, producing identical original secret
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Backup Chart ConfigMap</name>
  <files>charts/ten-backup/templates/configmap.yaml</files>
  <action>
    Update the ConfigMap in the ten-backup Helm chart to include the new scripts:

    - Add uat-backup-network-secret.sh to the data section
    - Add uat-simple-secret-split.go to the data section
    - Maintain existing scripts (generate-keys.sh, decrypt-backup.go, test-backup-restore.sh)
    - Ensure proper YAML formatting and indentation
    - Scripts should have executable permissions when mounted

    Check existing configmap.yaml structure and follow the same pattern for new script entries.
  </action>
  <verify>
    helm template charts/ten-backup | grep -A 20 "kind: ConfigMap" | grep "uat-backup-network-secret.sh\|uat-simple-secret-split.go"
  </verify>
  <done>
    ConfigMap includes both new scripts and Helm template validates without errors
  </done>
</task>

</tasks>

<verification>
- Enhanced backup script calls ten_BackupSharedSecret API successfully
- Simple secret sharing tool splits and reconstructs secrets correctly
- Backup infrastructure includes updated scripts in container deployment
- Secret splitting produces 2-of-3 threshold shares suitable for guardian distribution
</verification>

<success_criteria>
- UAT backup script produces encrypted backups via ten_BackupSharedSecret API
- Secret shares can be distributed to 3 guardians with 2-share recovery threshold
- Simple secret sharing implementation validates through round-trip testing
- Backup tools container includes all necessary scripts for network secret operations
</success_criteria>

<output>
After completion, create `.planning/phases/02-network-secret-backup/02-01-SUMMARY.md`
</output>