---
phase: 01-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - charts/ten-backup/Chart.yaml
  - charts/ten-backup/values.yaml
  - charts/ten-backup/templates/deployment.yaml
  - charts/ten-backup/templates/configmap.yaml
  - charts/ten-backup/templates/service.yaml
  - nonprod-argocd-config/apps/envs/uat/backup-tools-app.yaml
autonomous: true

must_haves:
  truths:
    - "UAT operators can generate backup keys using deployed tools"
    - "Go decryption tool works with generated keys in container environment"
    - "Backup tools run in UAT Kubernetes environment"
  artifacts:
    - path: "charts/ten-backup/Chart.yaml"
      provides: "Helm chart definition for backup tools"
      min_lines: 15
    - path: "charts/ten-backup/templates/deployment.yaml"
      provides: "K8s deployment for backup tools container"
      contains: "image:"
    - path: "nonprod-argocd-config/apps/envs/uat/backup-tools-app.yaml"
      provides: "ArgoCD application for UAT deployment"
      contains: "source:"
  key_links:
    - from: "charts/ten-backup/templates/configmap.yaml"
      to: "scripts/*.sh"
      via: "volume mount in deployment"
      pattern: "scripts/"
    - from: "nonprod-argocd-config/apps/envs/uat/backup-tools-app.yaml"
      to: "charts/ten-backup"
      via: "source path reference"
      pattern: "charts/ten-backup"
---

<objective>
Create Kubernetes deployment infrastructure for UAT backup tools using existing scripts

Purpose: Enable UAT operators to perform backup operations through Kubernetes-deployed tools rather than local script execution
Output: Helm chart and UAT deployment configuration for backup tools container
</objective>

<execution_context>
@/Users/krish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/krish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-CONTEXT.md
@scripts/generate-keys.sh
@scripts/decrypt-backup.go
@scripts/test-backup-restore.sh
@charts/ten-tools/Chart.yaml
@.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Backup Tools Helm Chart</name>
  <files>
    charts/ten-backup/Chart.yaml
    charts/ten-backup/values.yaml
    charts/ten-backup/templates/deployment.yaml
    charts/ten-backup/templates/configmap.yaml
    charts/ten-backup/templates/service.yaml
  </files>
  <action>
    Create new Helm chart following existing ten-tools pattern. Chart packages existing backup scripts into a container deployment:

    - Chart.yaml: Application chart v0.1.0, follows existing charts/*/Chart.yaml structure
    - values.yaml: Configurable image, replica count, service settings
    - deployment.yaml: Single container with Go 1.25.4 + openssl, volume mount for scripts from configmap
    - configmap.yaml: Mount all three scripts (generate-keys.sh, decrypt-backup.go, test-backup-restore.sh) into container
    - service.yaml: ClusterIP service for internal access to backup tools

    Use golang:1.25-alpine as base image. Container should have openssl, xxd tools installed. Scripts mounted at /scripts/ with proper executable permissions.
  </action>
  <verify>
    helm template charts/ten-backup | grep -E "(kind:|image:|configMap)" to verify valid K8s manifests
  </verify>
  <done>
    Helm chart validates, generates deployment with scripts configmap, and exposes service for backup operations
  </done>
</task>

<task type="auto">
  <name>Task 2: Create UAT Deployment Configuration</name>
  <files>
    nonprod-argocd-config/apps/envs/uat/backup-tools-app.yaml
  </files>
  <action>
    Create ArgoCD application following existing pattern in nonprod-argocd-config/apps/envs/uat/. Application should:

    - Follow naming pattern: backup-tools-app.yaml
    - Reference charts/ten-backup as source path
    - Deploy to uat-backup namespace
    - Use UAT-specific values (single replica, minimal resources)
    - Follow existing syncPolicy pattern with automated sync enabled

    Check existing uat/*.yaml files for proper metadata labels, annotations, and ArgoCD application structure. Ensure consistent with environment patterns.
  </action>
  <verify>
    kubectl --dry-run=client apply -f nonprod-argocd-config/apps/envs/uat/backup-tools-app.yaml returns valid
  </verify>
  <done>
    ArgoCD application config validates and follows existing UAT deployment patterns for automatic backup tools deployment
  </done>
</task>

</tasks>

<verification>
- Helm chart templates generate valid Kubernetes manifests
- ArgoCD application references correct chart source path
- Scripts are properly mounted and executable in container environment
- Deployment follows existing ten-apps chart patterns and UAT environment structure
</verification>

<success_criteria>
- UAT operators can deploy backup tools via ArgoCD to uat-backup namespace
- Container includes all existing scripts with proper dependencies (Go, openssl, xxd)
- Backup tools accessible within UAT Kubernetes environment for backup operations
- Chart structure consistent with existing ten-tools, ten-gateway patterns
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-01-SUMMARY.md`
</output>