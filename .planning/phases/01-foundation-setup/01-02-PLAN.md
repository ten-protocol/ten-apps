---
phase: 01-foundation-setup
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - scripts/automated-backup-test.sh
  - scripts/k8s-backup-test.sh
autonomous: false

must_haves:
  truths:
    - "Complete backup/restore cycle validates successfully in UAT environment"
    - "Test procedure runs automatically against deployed backup tools"
    - "Backup keys generated in Kubernetes work with encryption/decryption"
  artifacts:
    - path: "scripts/automated-backup-test.sh"
      provides: "Automated test orchestration script"
      contains: "kubectl"
    - path: "scripts/k8s-backup-test.sh"
      provides: "Kubernetes-aware backup testing"
      contains: "backup-tools"
  key_links:
    - from: "scripts/automated-backup-test.sh"
      to: "uat-backup namespace"
      via: "kubectl commands"
      pattern: "kubectl.*uat-backup"
    - from: "scripts/k8s-backup-test.sh"
      to: "charts/ten-backup"
      via: "deployed backup tools"
      pattern: "kubectl exec.*backup"
---

<objective>
Create automated test infrastructure to validate backup/restore procedures in UAT Kubernetes environment

Purpose: Ensure backup tools work correctly in deployed environment and provide automated validation of complete backup cycle
Output: Automated test scripts that validate backup tools against UAT Kubernetes deployment
</objective>

<execution_context>
@/Users/krish/.claude/get-shit-done/workflows/execute-plan.md
@/Users/krish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-CONTEXT.md
@scripts/test-backup-restore.sh
@.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Kubernetes-Aware Test Script</name>
  <files>
    scripts/k8s-backup-test.sh
  </files>
  <action>
    Create Kubernetes-aware version of test-backup-restore.sh that executes backup operations inside deployed containers:

    - Adapt existing test-backup-restore.sh structure for K8s environment
    - Use kubectl exec to run generate-keys.sh inside backup tools pod
    - Use kubectl exec to run decrypt-backup.go inside backup tools pod
    - Verify scripts work correctly in container environment with mounted dependencies
    - Include pod status checks and connection validation
    - Test key generation and storage within persistent volumes

    Follow same test structure as original but replace local execution with kubectl exec commands targeting uat-backup namespace pods.
  </action>
  <verify>
    bash -n scripts/k8s-backup-test.sh returns valid syntax
  </verify>
  <done>
    Script validates backup tools functionality within Kubernetes environment using kubectl exec operations
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Automated Test Orchestration</name>
  <files>
    scripts/automated-backup-test.sh
  </files>
  <action>
    Create orchestration script that fully automates UAT backup testing:

    - Check UAT backup tools deployment status via kubectl
    - Run k8s-backup-test.sh with automated input responses
    - Capture and validate test outputs
    - Provide clear pass/fail results with specific failure reasons
    - Include cleanup of test artifacts
    - Generate test report with key validation results

    Script should be suitable for CI/CD pipeline integration and provide clear exit codes (0=success, 1=failure).
  </action>
  <verify>
    bash -n scripts/automated-backup-test.sh returns valid syntax
  </verify>
  <done>
    Orchestration script provides hands-off validation of complete backup system functionality in UAT environment
  </done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete UAT backup tools deployment and automated testing infrastructure</what-built>
  <how-to-verify>
    1. Verify backup tools deployed: kubectl get pods -n uat-backup
    2. Run automated test: cd scripts && ./automated-backup-test.sh
    3. Check test results show successful key generation, encryption/decryption cycle
    4. Verify scripts execute properly in Kubernetes environment
    5. Confirm no errors in backup tools pod logs: kubectl logs -n uat-backup deployment/backup-tools
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- Automated test scripts execute without errors
- Backup tools respond correctly to kubectl exec operations
- Complete backup/restore cycle validates in UAT Kubernetes environment
- Test outputs provide clear validation of backup system functionality
</verification>

<success_criteria>
- UAT operators can run automated tests to validate backup system health
- Complete backup cycle (key generation -> encryption -> decryption) works in Kubernetes
- Test infrastructure suitable for ongoing validation and CI/CD integration
- Backup tools proven functional in UAT environment deployment
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-02-SUMMARY.md`
</output>